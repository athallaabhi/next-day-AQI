<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Jakarta AQI Sandbox & Forecast</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        max-width: 600px;
        margin: 2em auto;
      }
      .slider-label {
        display: flex;
        justify-content: space-between;
      }
    </style>
  </head>
  <body class="p-4">
    <h1 class="mb-4">Jakarta AQI Sandbox & Forecast</h1>
    <form method="post" action="#{{ mode }}">
      <div class="mb-3">
        <label class="form-check-label me-3">
          <input class="form-check-input" type="radio" name="mode"
          value="sandbox" onchange="this.form.submit()" {% if mode=='sandbox'
          %}checked{% endif %}/> Sandbox
        </label>
        <label class="form-check-label">
          <input
            class="form-check-input"
            type="radio"
            name="mode"
            value="historical"
            onchange="this.form.submit()"
            {%
            if
            mode!="sandbox"
            %}checked{%
            endif
            %}
          />
          Historical
        </label>
      </div>

      {% if mode=='sandbox' %}
      <div id="sandbox">
        <h4>Sandbox Inputs</h4>
        {% for col, (mn, mx) in slider_ranges.items() %}
        <div class="mb-3">
          <div class="slider-label">
            <label for="{{col}}">{{col}}</label>
            <span id="{{col}}_val">
              {{ (inputs[col] if inputs[col] is defined else
              ((mn+mx)/2))|round(2) }}
            </span>
          </div>
          <input
            type="range"
            class="form-range"
            id="{{col}}"
            name="{{col}}"
            min="{{mn}}"
            max="{{mx}}"
            step="0.1"
            value="{{ inputs[col] if inputs[col] is defined else ((mn+mx)/2) }}"
            oninput="document.getElementById('{{col}}_val').textContent = parseFloat(this.value).toFixed(2);
                            this.form.submit();"
          />
        </div>
        {% endfor %} {% if result %}
        <div class="alert alert-info">
          <strong>AQI:</strong> {{ "%.2f"|format(result.aqi) }} &nbsp;
          <em>(worst: {{ result.worst }})</em>
        </div>
        {% endif %}
      </div>

      {% else %}
      <div id="historical">
        <h4>Historical Mode</h4>
        <div class="mb-3">
          <label for="hist_date" class="form-label">Pick a date</label>
          <input
            type="date"
            id="hist_date"
            name="hist_date"
            class="form-control"
            min="{{min_date}}"
            max="{{max_date}}"
            onchange="this.form.submit();"
            value="{{ inputs.hist_date if inputs.hist_date is defined else '' }}"
          />
        </div>

        {% if result %}
        <div class="alert alert-info">
          <strong>Predicted AQI:</strong> {{ "%.2f"|format(result.pred) }}<br />
          <strong>Actual AQI:</strong> {{ "%.2f"|format(result.actual) }}
        </div>
        {% endif %}
      </div>
      {% endif %} {% if error %}
      <div class="alert alert-danger">{{ error }}</div>
      {% endif %}
    </form>
  </body>
</html>
